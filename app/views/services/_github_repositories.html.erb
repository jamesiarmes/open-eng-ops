<!--TODO: Add filters-->

<table data-mdb-fixed-header="true" class="table table-hover table-striped table-sticky align-middle mb-0 bg-white github-repos">
  <thead class="bg-light">
  <tr>
    <th scope="col"><i title="Language" class="fa-solid fa-laptop-code"></i></th>
    <th scope="col"><%= link_to 'Name', :sort => 'name' %></th>
    <th scope="col">Description</th>
    <th scope="col"><%= link_to 'Created', :sort => 'created' %></th>
    <th scope="col"><%= link_to 'Updated', :sort => 'updated' %></th>
    <th scope="col"><%= link_to 'Pushed', :sort => 'pushed' %></th>
    <th scope="col" class="text-center"><i class="fa-solid fa-star" title="Stargazers"></i></th>
    <th scope="col" class="text-center"><i class="fa-solid fa-eye" title="Watchers"></i></th>
    <th scope="col" class="text-center"><i class="fa-solid fa-code-fork" title="Forks"></i></th>
    <th scope="col" class="text-center"><i class="fa-solid fa-bug" title="Issues"></i></th>
    <th scope="col">License</th>
    <th scope="col">Branch</th>
  </tr>
  </thead>
  <tbody>
  <% @repos.each do |repo| %>
    <tr>
      <td class="repo-language">
        <% case repo.language&.downcase %>
        <% when 'c#' %>
          <i class="fa-brands fa-microsoft" title="<%= repo.language %>"></i>
        <% when 'c++' %>
          <i class="fa-solid fa-c" title="<%= repo.language %>"></i>
        <% when 'cartocss' %>
          <i class="fa-solid fa-globe" title="<%= repo.language %>"></i>
        <% when 'coffeescript' %>
          <i class="fa-solid fa-mug-hot" title="<%= repo.language %>"></i>
        <% when 'css' %>
          <i class="fa-brands fa-css3" title="<%= repo.language %>"></i>
        <% when 'dockerfile' %>
          <i class="fa-brands fa-docker" title="<%= repo.language %>"></i>
        <% when 'go' %>
          <i class="fa-brands fa-golang" title="<%= repo.language %>"></i>
        <% when 'groovy' %>
          <i class="fa-solid fa-star" title="<%= repo.language %>"></i>
        <% when 'html' %>
          <i class="fa-brands fa-html5" title="<%= repo.language %>"></i>
        <% when 'java' %>
          <i class="fa-brands fa-java" title="<%= repo.language %>"></i>
        <% when 'javascript' %>
          <i class="fa-brands fa-js" title="<%= repo.language %>"></i>
        <% when 'jupyter notebook' %>
          <i class="fa-solid fa-flask" title="<%= repo.language %>"></i>
        <% when 'objective-c' %>
          <i class="fa-brands fa-apple" title="<%= repo.language %>"></i>
        <% when 'php' %>
          <i class="fa-brands fa-php" title="<%= repo.language %>"></i>
        <% when 'plpgsql' %>
          <i class="fa-solid fa-database" title="<%= repo.language %>"></i>
        <% when 'hcl', 'puppet' %>
          <i class="fa-solid fa-gears" title="<%= repo.language %>"></i>
        <% when 'python' %>
          <i class="fa-brands fa-python" title="<%= repo.language %>"></i>
        <% when 'ruby' %>
          <i class="fa-solid fa-gem" title="<%= repo.language %>"></i>
        <% when 'scss' %>
          <i class="fa-brands fa-sass" title="<%= repo.language %>"></i>
        <% when 'shell' %>
          <i class="fa-solid fa-terminal" title="<%= repo.language %>"></i>
        <% else %>
          <%# ActionScript %>
          <i class="fa-solid fa-code" title="<%= repo.language || 'Other' %>"><%= repo.language %></i>
        <% end %>
      </td>
      <td class="repo-name">
        <i class="fa-solid <%= if repo.is_template
                                 'fa-book-bookmark'
                               elsif repo.fork
                                 'fa-code-fork'
                               elsif repo.private
                                 'fa-lock'
                               else
                                 'fa-book-atlas'
                               end %>"
           title="<%= repo.visibility.capitalize %><%= ' template' if repo.is_template %><%= ' fork' if repo.fork %>"></i>
        <%= link_to repo.name, github_repo_service_path(@service, repo: repo.name) %>
      </td>
      <td class="repo-description"><%= repo.description %></td>
      <td class="repo-created">
          <span title="<%= repo.created_at.to_datetime.to_formatted_s(:db) %>">
            <%= repo.created_at.to_datetime.to_formatted_s(:date) %>
          </span>
      </td>
      <td class="repo-updated">
          <span title="<%= repo.updated_at.to_datetime.to_formatted_s(:db) %>">
            <%= repo.updated_at.to_datetime.to_formatted_s(:date) %>
          </span>
      </td>
      <td class="repo-pushed">
        <% if repo.pushed_at %>
            <span title="<%= repo.pushed_at.to_datetime.to_formatted_s(:db) %>">
              <%= repo.pushed_at.to_datetime.to_formatted_s(:date) %>
            </span>
        <% end %>
      </td>
      <td class="repo-stargazers text-center"><%= repo.stargazers_count %></td>
      <td class="repo-watchers text-center"><%= repo.watchers %></td>
      <td class="repo-forks text-center"><%= repo.forks %></td>
      <td class="repo-issues text-center"><%= repo.open_issues %></td>
      <td class="repo-license">
        <% if repo.license %>
          <%= repo.license.name %>
        <% end %>
      </td>
      <td class="repo-branch"><%= repo.default_branch %></td>
    </tr>
  <% end %>
  </tbody>
</table>

<nav aria-label="Github repository pagination">
  <ul class="pagination justify-content-end m-3">
    <% if params[:page] && params[:page].to_i > 1  %>
      <li class="page-item">
        <%= link_to 'Previous', @pagination_params.merge(page:params[:page].to_i - 1), class: 'page-link' %>
      </li>
    <% else %>
      <li class="page-item disabled">
        <span class="page-link">Previous</span>
      </li>
    <% end %>

    <% (1..(@repos.count_pages.to_i > 0 ? @repos.count_pages.to_i : params[:page].to_i)).each do |page_num| %>
      <% if (params[:page]&.to_i || 1) == page_num %>
        <li class="page-item active" aria-current="page">
          <%= link_to page_num, '#', class: 'page-link', :page => page_num %>
          <span class="visually-hidden">(current)</span>
        </li>
      <% else %>
        <li class="page-item">
          <%= link_to page_num, @pagination_params.merge(page: page_num), class: 'page-link' %>
        </li>
      <% end %>
    <% end %>

    <% if @repos.has_next_page?  %>
      <li class="page-item">
        <%= link_to 'Next', @pagination_params.merge(page: params[:page].to_i + 1), class: 'page-link' %>
      </li>
    <% else %>
      <li class="page-item disabled">
        <span class="page-link">Next</span>
      </li>
    <% end %>
  </ul>
</nav>
